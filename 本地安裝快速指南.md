# 本地安裝快速指南（無需 Docker）

> 適用於 CPU 不支援虛擬化或無法安裝 Docker 的開發環境

## 📋 目錄

- [快速開始](#快速開始)
- [詳細步驟](#詳細步驟)
- [服務管理](#服務管理)
- [連線資訊](#連線資訊)
- [故障排除](#故障排除)

---

## 🚀 快速開始

### 一鍵安裝

在專案根目錄執行以下命令：

```powershell
# 1. 安裝 PostgreSQL
.\setup-scripts\06-setup-local-postgresql.ps1

# 2. 安裝 MinIO
.\setup-scripts\07-setup-local-minio.ps1
```

### 驗證安裝

```powershell
# 檢查 PostgreSQL
Get-Service -Name postgresql*

# 檢查 MinIO
Get-Process minio -ErrorAction SilentlyContinue

# 測試 PostgreSQL 連線
psql -U admin -d vendor_assessment -h localhost

# 訪問 MinIO 控制台
# 開啟瀏覽器：http://localhost:9001
```

---

## 📝 詳細步驟

### 步驟 1：建立專案結構

```powershell
# 執行基礎設定腳本
.\setup-scripts\01-create-structure.ps1
.\setup-scripts\02-init-workspace.ps1
.\setup-scripts\03-setup-shared.ps1
.\setup-scripts\05-create-env-files.ps1
```

### 步驟 2：安裝 PostgreSQL

執行安裝腳本，腳本會自動引導您：

```powershell
.\setup-scripts\06-setup-local-postgresql.ps1
```

安裝選項：
1. **使用 Chocolatey 自動安裝**（推薦，需管理員權限）
2. **手動下載安裝程式**
3. **使用雲端服務**（Supabase/Neon/ElephantSQL）

### 步驟 3：安裝 MinIO

```powershell
.\setup-scripts\07-setup-local-minio.ps1
```

腳本會：
- 下載 MinIO 執行檔到 `C:\minio`
- 建立啟動/停止腳本
- 詢問是否設定為 Windows 服務

### 步驟 4：啟動服務

**PostgreSQL**（通常自動啟動）
```powershell
# 檢查狀態
Get-Service -Name postgresql*

# 如未啟動，手動啟動
Start-Service postgresql-x64-18
```

**MinIO**
```powershell
# 方式 1：使用批次檔
C:\minio\start-minio.bat

# 方式 2：使用 PowerShell
C:\minio\start-minio.ps1

# 方式 3：如已設定為服務
Start-Service MinIO
```

### 步驟 5：啟動應用程式

```powershell
# 安裝依賴
pnpm install

# 啟動開發伺服器
pnpm dev

# 或分別啟動
pnpm dev:backend  # http://localhost:3000
pnpm dev:frontend # http://localhost:3001
```

---

## 🔧 服務管理

### PostgreSQL 管理

```powershell
# 檢查狀態
Get-Service -Name postgresql*

# 啟動服務
Start-Service postgresql-x64-18

# 停止服務
Stop-Service postgresql-x64-18

# 重新啟動
Restart-Service postgresql-x64-18

# 連線到資料庫
psql -U admin -d vendor_assessment -h localhost

# 執行 SQL 指令
psql -U admin -d vendor_assessment -h localhost -c "SELECT version();"
```

### MinIO 管理

```powershell
# 啟動（批次檔）
C:\minio\start-minio.bat

# 啟動（PowerShell）
C:\minio\start-minio.ps1

# 停止
C:\minio\stop-minio.bat
# 或在運行視窗按 Ctrl+C

# 如果設定為服務
Start-Service MinIO
Stop-Service MinIO
Get-Service MinIO
```

### 開機自動啟動

**PostgreSQL**
- 預設已設定為開機自動啟動

**MinIO**
```powershell
# 方式 1：使用 NSSM（在安裝時選擇）
# 已自動設定為開機啟動

# 方式 2：使用工作排程器
# 開啟「工作排程器」→ 建立基本工作
# 觸發程序：電腦啟動時
# 動作：啟動程式 C:\minio\start-minio.bat
```

---

## 🔗 連線資訊

### PostgreSQL

| 項目 | 值 |
|------|-----|
| 主機 | `localhost` |
| 連接埠 | `5432` |
| 資料庫 | `vendor_assessment` |
| 使用者 | `admin` |
| 密碼 | `password123` |
| 連線字串 | `postgresql://admin:password123@localhost:5432/vendor_assessment` |

### MinIO

| 項目 | 值 |
|------|-----|
| API 端點 | `http://localhost:9000` |
| 控制台 | `http://localhost:9001` |
| Access Key | `minioadmin` |
| Secret Key | `minioadmin123` |
| Bucket | `uploads` |

### 環境變數檔案

連線資訊已預設在環境變數檔案中：
- `apps/backend/.env`
- `apps/frontend/.env.local`

**無需修改**，直接使用即可！

---

## 🆘 故障排除

### PostgreSQL 無法連線

**症狀**：`psql: error: connection refused`

**解決方案**：
```powershell
# 1. 檢查服務狀態
Get-Service -Name postgresql*

# 2. 啟動服務
Start-Service postgresql-x64-18

# 3. 檢查連接埠
netstat -ano | findstr "5432"

# 4. 檢查防火牆
# 控制台 → Windows Defender 防火牆 → 進階設定
# 確認 PostgreSQL 規則已啟用

# 5. 查看日誌
# 預設位置：C:\Program Files\PostgreSQL\18\data\log
```

### MinIO 無法啟動

**症狀**：連接埠被占用或無法存取

**解決方案**：
```powershell
# 1. 檢查 MinIO 是否已在運行
Get-Process minio -ErrorAction SilentlyContinue

# 2. 檢查連接埠是否被占用
netstat -ano | findstr "9000"
netstat -ano | findstr "9001"

# 3. 終止佔用的進程（請先確認）
# taskkill /PID <進程ID> /F

# 4. 重新啟動 MinIO
C:\minio\start-minio.bat

# 5. 檢查防火牆設定
```

### 資料庫遷移失敗

**症狀**：`TypeORM migration failed`

**解決方案**：
```powershell
# 1. 確認 PostgreSQL 正在運行
Get-Service -Name postgresql*

# 2. 測試連線
psql -U admin -d vendor_assessment -h localhost

# 3. 檢查環境變數
cat apps\backend\.env

# 4. 手動執行遷移
cd apps/backend
pnpm run migration:run
```

### 後端無法連接 MinIO

**症狀**：`Error: connect ECONNREFUSED 127.0.0.1:9000`

**解決方案**：
```powershell
# 1. 確認 MinIO 正在運行
Get-Process minio -ErrorAction SilentlyContinue

# 2. 測試 MinIO API
curl http://localhost:9000/minio/health/live

# 3. 訪問控制台確認
# 開啟：http://localhost:9001
# 登入：minioadmin / minioadmin123

# 4. 檢查環境變數
# apps/backend/.env
MINIO_ENDPOINT=localhost
MINIO_PORT=9000
MINIO_USE_SSL=false
```

### 找不到 psql 命令

**症狀**：`psql: command not found`

**解決方案**：
```powershell
# 1. 找到 PostgreSQL 安裝路徑
Get-Command psql -ErrorAction SilentlyContinue

# 2. 手動加入 PATH
$env:PATH += ";C:\Program Files\PostgreSQL\18\bin"

# 3. 永久加入 PATH（系統環境變數）
# 控制台 → 系統 → 進階系統設定 → 環境變數
# 編輯 Path，加入：C:\Program Files\PostgreSQL\18\bin
```

---

## 📚 延伸閱讀

### 詳細文件

- **`setup-scripts/06-install-local-services.md`**
  完整的安裝指南，包含手動安裝步驟

- **`setup-scripts/README.md`**
  所有設定腳本說明

- **`MVP專案執行文件.md`**
  完整的開發指南

### 管理工具

**PostgreSQL 管理工具**
- [pgAdmin](https://www.pgadmin.org/) - 官方圖形化管理工具
- [DBeaver](https://dbeaver.io/) - 通用資料庫管理工具

**MinIO 管理**
- MinIO Console: http://localhost:9001
- [MinIO Client (mc)](https://min.io/docs/minio/windows/reference/minio-mc.html) - 命令列工具

---

## ✅ 檢查清單

安裝完成後，請確認：

- [ ] PostgreSQL 服務已啟動
- [ ] 可以使用 `psql` 連線到資料庫
- [ ] 資料庫 `vendor_assessment` 已建立
- [ ] 使用者 `admin` 可以存取
- [ ] MinIO 已啟動（可存取控制台）
- [ ] 可以存取 http://localhost:9001
- [ ] 使用 `minioadmin` 可以登入
- [ ] 環境變數檔案 `.env` 已建立
- [ ] `pnpm install` 執行成功
- [ ] `pnpm dev` 可以啟動應用程式

---

## 💡 提示

### 開發流程

```powershell
# 每天開發前
# 1. 確認服務運行
Get-Service postgresql*
Get-Process minio

# 2. 如未運行，啟動服務
Start-Service postgresql-x64-18
C:\minio\start-minio.bat

# 3. 啟動應用
pnpm dev
```

### 與 Docker 方案的差異

| 項目 | Docker 方案 | 本地安裝方案 |
|------|------------|-------------|
| 虛擬化需求 | ✅ 需要 | ❌ 不需要 |
| 安裝複雜度 | 簡單（一鍵啟動） | 中等（需逐步安裝） |
| 資源佔用 | 較高 | 較低 |
| 啟動速度 | 較慢 | 較快 |
| 連線資訊 | 相同 | 相同 |
| 管理方式 | docker-compose | Windows 服務 |
| 適用環境 | 開發/測試 | 開發/測試/生產 |

### 優勢

✅ **無需虛擬化**：舊電腦或不支援的 CPU 也能開發  
✅ **更輕量**：直接運行，無需容器開銷  
✅ **更快速**：服務啟動更快  
✅ **易於管理**：使用 Windows 服務管理  
✅ **相容性佳**：與 Docker 方案配置完全相同

---

**建立日期**: 2025-10-27  
**最後更新**: 2025-10-27  
**維護者**: 開發團隊


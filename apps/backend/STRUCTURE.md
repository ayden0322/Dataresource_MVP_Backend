# å¾Œç«¯å°ˆæ¡ˆçµæ§‹

## ğŸ“ ç›®éŒ„çµæ§‹

```
apps/backend/
â”œâ”€â”€ src/                          # åŸå§‹ç¢¼ç›®éŒ„
â”‚   â”œâ”€â”€ auth/                     # èªè­‰æ¨¡çµ„
â”‚   â”‚   â”œâ”€â”€ decorators/           # è‡ªè¨‚è£é£¾å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ current-user.decorator.ts  # å–å¾—ç•¶å‰ä½¿ç”¨è€…
â”‚   â”‚   â”‚   â”œâ”€â”€ public.decorator.ts        # å…¬é–‹ç«¯é»æ¨™è¨˜
â”‚   â”‚   â”‚   â””â”€â”€ roles.decorator.ts         # è§’è‰²æ¬Šé™æ¨™è¨˜
â”‚   â”‚   â”œâ”€â”€ dto/                  # è³‡æ–™å‚³è¼¸ç‰©ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ login.dto.ts
â”‚   â”‚   â”‚   â””â”€â”€ register.dto.ts
â”‚   â”‚   â”œâ”€â”€ guards/               # å®ˆè¡›
â”‚   â”‚   â”‚   â”œâ”€â”€ jwt-auth.guard.ts     # JWT èªè­‰å®ˆè¡›
â”‚   â”‚   â”‚   â”œâ”€â”€ local-auth.guard.ts   # æœ¬åœ°èªè­‰å®ˆè¡›
â”‚   â”‚   â”‚   â””â”€â”€ roles.guard.ts        # è§’è‰²æ¬Šé™å®ˆè¡›
â”‚   â”‚   â”œâ”€â”€ strategies/           # Passport ç­–ç•¥
â”‚   â”‚   â”‚   â”œâ”€â”€ jwt.strategy.ts       # JWT ç­–ç•¥
â”‚   â”‚   â”‚   â””â”€â”€ local.strategy.ts     # æœ¬åœ°ç­–ç•¥
â”‚   â”‚   â”œâ”€â”€ auth.controller.ts    # æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ auth.module.ts        # æ¨¡çµ„
â”‚   â”‚   â””â”€â”€ auth.service.ts       # æœå‹™
â”‚   â”‚
â”‚   â”œâ”€â”€ users/                    # ä½¿ç”¨è€…ç®¡ç†æ¨¡çµ„
â”‚   â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â”‚   â”œâ”€â”€ create-user.dto.ts
â”‚   â”‚   â”‚   â””â”€â”€ update-user.dto.ts
â”‚   â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â”‚   â””â”€â”€ user.entity.ts        # ä½¿ç”¨è€…å¯¦é«”
â”‚   â”‚   â”œâ”€â”€ users.controller.ts
â”‚   â”‚   â”œâ”€â”€ users.module.ts
â”‚   â”‚   â””â”€â”€ users.service.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ projects/                 # å°ˆæ¡ˆç®¡ç†æ¨¡çµ„
â”‚   â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â”‚   â”œâ”€â”€ create-project.dto.ts
â”‚   â”‚   â”‚   â””â”€â”€ update-project.dto.ts
â”‚   â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â”‚   â”œâ”€â”€ project.entity.ts         # å°ˆæ¡ˆå¯¦é«”
â”‚   â”‚   â”‚   â””â”€â”€ required-document.entity.ts  # å¿…è¦æ–‡ä»¶å¯¦é«”
â”‚   â”‚   â”œâ”€â”€ projects.controller.ts
â”‚   â”‚   â”œâ”€â”€ projects.module.ts
â”‚   â”‚   â””â”€â”€ projects.service.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ uploads/                  # æª”æ¡ˆä¸Šå‚³æ¨¡çµ„
â”‚   â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â”‚   â””â”€â”€ upload-file.dto.ts
â”‚   â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â”‚   â””â”€â”€ upload.entity.ts      # ä¸Šå‚³è¨˜éŒ„å¯¦é«”
â”‚   â”‚   â”œâ”€â”€ storage.service.ts        # MinIO å„²å­˜æœå‹™
â”‚   â”‚   â”œâ”€â”€ uploads.controller.ts
â”‚   â”‚   â”œâ”€â”€ uploads.module.ts
â”‚   â”‚   â””â”€â”€ uploads.service.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ reviews/                  # å¯©æ ¸æ¨¡çµ„
â”‚   â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â”‚   â””â”€â”€ create-review.dto.ts
â”‚   â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â”‚   â””â”€â”€ review.entity.ts      # å¯©æ ¸è¨˜éŒ„å¯¦é«”
â”‚   â”‚   â”œâ”€â”€ reviews.controller.ts
â”‚   â”‚   â”œâ”€â”€ reviews.module.ts
â”‚   â”‚   â””â”€â”€ reviews.service.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ config/                   # é…ç½®æª”æ¡ˆ
â”‚   â”‚   â”œâ”€â”€ configuration.ts      # ç’°å¢ƒè®Šæ•¸é…ç½®
â”‚   â”‚   â””â”€â”€ typeorm.config.ts     # TypeORM é…ç½®
â”‚   â”‚
â”‚   â”œâ”€â”€ database/                 # è³‡æ–™åº«ç›¸é—œ
â”‚   â”‚   â”œâ”€â”€ migrations/           # è³‡æ–™åº«é·ç§»
â”‚   â”‚   â”‚   â””â”€â”€ 1704067200000-InitialSchema.ts
â”‚   â”‚   â””â”€â”€ seeds/                # åˆå§‹è³‡æ–™
â”‚   â”‚       â”œâ”€â”€ initial-user.seed.ts   # åˆå§‹ä½¿ç”¨è€…
â”‚   â”‚       â””â”€â”€ seed.ts                # Seed åŸ·è¡Œæª”
â”‚   â”‚
â”‚   â”œâ”€â”€ app.controller.ts         # æ‡‰ç”¨ç¨‹å¼æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ app.module.ts             # æ‡‰ç”¨ç¨‹å¼ä¸»æ¨¡çµ„
â”‚   â”œâ”€â”€ app.service.ts            # æ‡‰ç”¨ç¨‹å¼æœå‹™
â”‚   â””â”€â”€ main.ts                   # æ‡‰ç”¨ç¨‹å¼å…¥å£
â”‚
â”œâ”€â”€ test/                         # æ¸¬è©¦ç›®éŒ„
â”œâ”€â”€ .env                          # ç’°å¢ƒè®Šæ•¸
â”œâ”€â”€ .env.example                  # ç’°å¢ƒè®Šæ•¸ç¯„ä¾‹
â”œâ”€â”€ .eslintrc.js                  # ESLint é…ç½®
â”œâ”€â”€ .gitignore                    # Git å¿½ç•¥æª”æ¡ˆ
â”œâ”€â”€ .prettierrc                   # Prettier é…ç½®
â”œâ”€â”€ Dockerfile                    # Docker æ˜ åƒæª”
â”œâ”€â”€ jest.config.js                # Jest é…ç½®
â”œâ”€â”€ nest-cli.json                 # NestJS CLI é…ç½®
â”œâ”€â”€ package.json                  # å¥—ä»¶ä¾è³´
â”œâ”€â”€ tsconfig.json                 # TypeScript é…ç½®
â”œâ”€â”€ zbpack.json                   # Zeabur éƒ¨ç½²é…ç½®
â”œâ”€â”€ README.md                     # å°ˆæ¡ˆèªªæ˜
â”œâ”€â”€ QUICKSTART.md                 # å¿«é€Ÿå•Ÿå‹•æŒ‡å—
â””â”€â”€ STRUCTURE.md                  # å°ˆæ¡ˆçµæ§‹èªªæ˜ï¼ˆæœ¬æª”æ¡ˆï¼‰
```

## ğŸ“¦ æ¨¡çµ„èªªæ˜

### Auth æ¨¡çµ„ (auth/)

è² è²¬ä½¿ç”¨è€…èªè­‰èˆ‡æˆæ¬Šï¼š

- **JWT èªè­‰**: ä½¿ç”¨ JWT Token é€²è¡Œç„¡ç‹€æ…‹èªè­‰
- **è§’è‰²æ¬Šé™**: æ”¯æ´ SUPER_ADMINã€ADMINã€VIEWER ä¸‰ç¨®è§’è‰²
- **å®ˆè¡›æ©Ÿåˆ¶**: ä¿è­·éœ€è¦èªè­‰çš„è·¯ç”±
- **è£é£¾å™¨**: æä¾›ä¾¿æ·çš„æ¬Šé™æ§åˆ¶

**ä¸»è¦åŠŸèƒ½**:
- ä½¿ç”¨è€…ç™»å…¥
- ä½¿ç”¨è€…è¨»å†Š
- å–å¾—å€‹äººè³‡æ–™
- Token é©—è­‰

### Users æ¨¡çµ„ (users/)

ç®¡ç†ç³»çµ±ä½¿ç”¨è€…ï¼š

- **ä½¿ç”¨è€… CRUD**: å»ºç«‹ã€æŸ¥è©¢ã€æ›´æ–°ã€åˆªé™¤ä½¿ç”¨è€…
- **å¯†ç¢¼åŠ å¯†**: ä½¿ç”¨ bcrypt åŠ å¯†å¯†ç¢¼
- **è§’è‰²ç®¡ç†**: ç®¡ç†ä½¿ç”¨è€…è§’è‰²æ¬Šé™
- **è»Ÿåˆªé™¤**: åœç”¨ä½¿ç”¨è€…è€Œéç›´æ¥åˆªé™¤

**ä¸»è¦åŠŸèƒ½**:
- æŸ¥è©¢æ‰€æœ‰ä½¿ç”¨è€…
- æŸ¥è©¢å–®ä¸€ä½¿ç”¨è€…
- å»ºç«‹æ–°ä½¿ç”¨è€…
- æ›´æ–°ä½¿ç”¨è€…è³‡æ–™
- åœç”¨/åˆªé™¤ä½¿ç”¨è€…

### Projects æ¨¡çµ„ (projects/)

ç®¡ç†å·¥ç¨‹å°ˆæ¡ˆï¼š

- **å°ˆæ¡ˆç®¡ç†**: å»ºç«‹å’Œç®¡ç†å°ˆæ¡ˆ
- **æ–‡ä»¶æ¸…å–®**: è¨­å®šå°ˆæ¡ˆæ‰€éœ€æ–‡ä»¶
- **ä¸Šå‚³é€£çµ**: ç”¢ç”Ÿå°ˆæ¡ˆå°ˆå±¬çš„ä¸Šå‚³ Token
- **ç‹€æ…‹ç®¡ç†**: ç®¡ç†å°ˆæ¡ˆç‹€æ…‹ï¼ˆè‰ç¨¿/é€²è¡Œä¸­/å·²å®Œæˆ/å·²æ­¸æª”ï¼‰

**ä¸»è¦åŠŸèƒ½**:
- å»ºç«‹å°ˆæ¡ˆä¸¦è¨­å®šæ‰€éœ€æ–‡ä»¶
- æŸ¥è©¢å°ˆæ¡ˆåˆ—è¡¨
- å–å¾—å°ˆæ¡ˆè©³æƒ…
- ç”¢ç”Ÿä¸Šå‚³é€£çµ
- æ ¹æ“š Token å–å¾—å°ˆæ¡ˆï¼ˆä¾›å» å•†ä½¿ç”¨ï¼‰
- æ›´æ–°å°ˆæ¡ˆç‹€æ…‹

### Uploads æ¨¡çµ„ (uploads/)

è™•ç†æª”æ¡ˆä¸Šå‚³ï¼š

- **æª”æ¡ˆä¸Šå‚³**: æ¥æ”¶ä¸¦å„²å­˜æª”æ¡ˆåˆ° MinIO
- **æª”æ¡ˆé©—è­‰**: æª¢æŸ¥æª”æ¡ˆé¡å‹å’Œå¤§å°
- **ç‰ˆæœ¬æ§åˆ¶**: æ”¯æ´åŒä¸€æ–‡ä»¶å¤šæ¬¡ä¸Šå‚³
- **MinIO æ•´åˆ**: ä½¿ç”¨ MinIO ä½œç‚ºç‰©ä»¶å„²å­˜

**ä¸»è¦åŠŸèƒ½**:
- ä¸Šå‚³æª”æ¡ˆï¼ˆå…¬é–‹ç«¯é»ï¼‰
- æŸ¥è©¢ä¸Šå‚³è¨˜éŒ„
- ä¸‹è¼‰æª”æ¡ˆ
- å–å¾—æª”æ¡ˆ URL
- åˆªé™¤ä¸Šå‚³è¨˜éŒ„

### Reviews æ¨¡çµ„ (reviews/)

æ–‡ä»¶å¯©æ ¸ç®¡ç†ï¼š

- **å¯©æ ¸æµç¨‹**: é€šéæˆ–é€€å›æ–‡ä»¶
- **å¯©æ ¸å‚™è¨»**: è¨˜éŒ„å¯©æ ¸æ„è¦‹
- **å¯©æ ¸æ­·å²**: è¿½è¹¤æ–‡ä»¶å¯©æ ¸è¨˜éŒ„
- **ç‹€æ…‹åŒæ­¥**: è‡ªå‹•æ›´æ–°æª”æ¡ˆç‹€æ…‹

**ä¸»è¦åŠŸèƒ½**:
- å»ºç«‹å¯©æ ¸è¨˜éŒ„
- æŸ¥è©¢å¯©æ ¸è¨˜éŒ„
- æ ¹æ“šå°ˆæ¡ˆæŸ¥è©¢å¯©æ ¸
- æ ¹æ“šä¸Šå‚³è¨˜éŒ„æŸ¥è©¢å¯©æ ¸

## ğŸ—ƒï¸ è³‡æ–™åº«å¯¦é«”

### User (users)

ä½¿ç”¨è€…å¯¦é«”ï¼ŒåŒ…å«ï¼š
- åŸºæœ¬è³‡æ–™ï¼ˆemail, nameï¼‰
- å¯†ç¢¼ï¼ˆåŠ å¯†ï¼‰
- è§’è‰²ï¼ˆSUPER_ADMIN, ADMIN, VIEWERï¼‰
- å•Ÿç”¨ç‹€æ…‹

### Project (projects)

å°ˆæ¡ˆå¯¦é«”ï¼ŒåŒ…å«ï¼š
- å°ˆæ¡ˆåç¨±å’Œæè¿°
- å°ˆæ¡ˆç‹€æ…‹
- ä¸Šå‚³ Token
- å»ºç«‹è€…é—œè¯

### RequiredDocument (required_documents)

å¿…è¦æ–‡ä»¶å¯¦é«”ï¼ŒåŒ…å«ï¼š
- æ–‡ä»¶åç¨±å’Œæè¿°
- æ˜¯å¦å¿…å¡«
- æ‰€å±¬å°ˆæ¡ˆ

### Upload (uploads)

ä¸Šå‚³è¨˜éŒ„å¯¦é«”ï¼ŒåŒ…å«ï¼š
- æª”æ¡ˆè³‡è¨Šï¼ˆåç¨±ã€å¤§å°ã€é¡å‹ï¼‰
- å„²å­˜è·¯å¾‘
- ç‰ˆæœ¬è™Ÿ
- ä¸Šå‚³è€…è³‡è¨Š
- å¯©æ ¸ç‹€æ…‹

### Review (reviews)

å¯©æ ¸è¨˜éŒ„å¯¦é«”ï¼ŒåŒ…å«ï¼š
- å¯©æ ¸ç‹€æ…‹
- å¯©æ ¸å‚™è¨»
- å¯©æ ¸è€…
- é—œè¯çš„ä¸Šå‚³è¨˜éŒ„

## ğŸ” èªè­‰èˆ‡æˆæ¬Š

### JWT ç­–ç•¥

ä½¿ç”¨ JWT Token é€²è¡Œèªè­‰ï¼š
1. ä½¿ç”¨è€…ç™»å…¥æˆåŠŸå¾Œå–å¾— Token
2. å¾ŒçºŒè«‹æ±‚åœ¨ Header ä¸­æ”œå¸¶ Token
3. ä¼ºæœå™¨é©—è­‰ Token ä¸¦å–å¾—ä½¿ç”¨è€…è³‡è¨Š

### è§’è‰²æ¬Šé™

ä¸‰ç¨®è§’è‰²æ¬Šé™ï¼š

| è§’è‰² | æ¬Šé™ |
|------|------|
| SUPER_ADMIN | æœ€é«˜æ¬Šé™ï¼Œå¯ç®¡ç†æ‰€æœ‰åŠŸèƒ½ |
| ADMIN | å¯ç®¡ç†å°ˆæ¡ˆã€å¯©æ ¸æ–‡ä»¶ |
| VIEWER | å”¯è®€æ¬Šé™ï¼Œå¯æŸ¥çœ‹å°ˆæ¡ˆå’Œæ–‡ä»¶ |

### å®ˆè¡›ä½¿ç”¨

```typescript
@Controller('projects')
@UseGuards(JwtAuthGuard, RolesGuard)  // éœ€è¦èªè­‰å’Œè§’è‰²æª¢æŸ¥
export class ProjectsController {
  
  @Post()
  @Roles(UserRole.SUPER_ADMIN, UserRole.ADMIN)  // åªæœ‰ SUPER_ADMIN å’Œ ADMIN å¯å­˜å–
  create() { ... }
  
  @Public()  // å…¬é–‹ç«¯é»ï¼Œä¸éœ€è¦èªè­‰
  @Get('token/:token')
  findByToken() { ... }
}
```

## ğŸ“ DTO é©—è­‰

ä½¿ç”¨ class-validator é€²è¡Œè³‡æ–™é©—è­‰ï¼š

```typescript
export class CreateProjectDto {
  @IsString()
  @MinLength(2, { message: 'å°ˆæ¡ˆåç¨±è‡³å°‘éœ€è¦ 2 å€‹å­—å…ƒ' })
  name: string;

  @IsArray()
  @ValidateNested({ each: true })
  requiredDocuments: RequiredDocumentDto[];
}
```

## ğŸ”„ è³‡æ–™åº«é·ç§»

### å»ºç«‹é·ç§»

```bash
pnpm migration:generate -- src/database/migrations/MigrationName
```

### åŸ·è¡Œé·ç§»

```bash
pnpm migration:run
```

### å›æ»¾é·ç§»

```bash
pnpm migration:revert
```

## ğŸŒ± åˆå§‹è³‡æ–™ (Seeds)

åŸ·è¡Œ Seed å»ºç«‹åˆå§‹è³‡æ–™ï¼š

```bash
pnpm seed
```

æœƒå»ºç«‹ï¼š
- é è¨­ç®¡ç†å“¡å¸³è™Ÿï¼ˆadmin@example.com / admin123456ï¼‰

## ğŸ“¦ MinIO å„²å­˜æœå‹™

### åˆå§‹åŒ–

æ‡‰ç”¨ç¨‹å¼å•Ÿå‹•æ™‚è‡ªå‹•æª¢æŸ¥ä¸¦å»ºç«‹ Bucketã€‚

### æª”æ¡ˆä¸Šå‚³

```typescript
await storageService.uploadFile(file, projectId, documentId);
```

### æª”æ¡ˆä¸‹è¼‰

```typescript
const buffer = await storageService.downloadFile(filename);
```

### å–å¾—æª”æ¡ˆ URL

```typescript
const url = await storageService.getFileUrl(filename);
```

## ğŸ§ª æ¸¬è©¦

### å–®å…ƒæ¸¬è©¦

```bash
pnpm test
```

### æ¸¬è©¦è¦†è“‹ç‡

```bash
pnpm test:cov
```

### ç›£è¦–æ¨¡å¼

```bash
pnpm test:watch
```

## ğŸš€ éƒ¨ç½²

### å»ºç½®

```bash
pnpm build
```

### åŸ·è¡Œ

```bash
pnpm start:prod
```

### Docker

```bash
docker build -t vendor-assessment-backend .
docker run -p 3000:3000 --env-file .env vendor-assessment-backend
```

## ğŸ“š ç›¸é—œæ–‡ä»¶

- [å¿«é€Ÿå•Ÿå‹•æŒ‡å—](./QUICKSTART.md)
- [API æ–‡ä»¶](./README.md)
- [å°ˆæ¡ˆåŸ·è¡Œæ–‡ä»¶](../../MVPå°ˆæ¡ˆåŸ·è¡Œæ–‡ä»¶.md)

---

**æœ€å¾Œæ›´æ–°**: 2025-10-27


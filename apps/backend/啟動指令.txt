==========================================================
  廠商安全評估系統 - 後端啟動指令
==========================================================

📍 當前位置: C:\Users\user\Desktop\Cursor\Dataresource_MVP_Backend

==========================================================
  步驟 1: 安裝依賴
==========================================================

pnpm install

==========================================================
  步驟 2: 確認資料庫和 MinIO 已啟動
==========================================================

# 檢查 PostgreSQL
Get-Service -Name postgresql*

# 如未啟動，執行：
Start-Service postgresql-x64-18

# 檢查 MinIO
Get-Process minio

# 如未啟動，執行：
C:\minio\start-minio.bat

==========================================================
  步驟 3: 執行資料庫遷移
==========================================================

pnpm --filter backend run migration:run

==========================================================
  步驟 4: 建立初始管理員帳號
==========================================================

pnpm --filter backend run seed

# 預設管理員帳號：
# Email: admin@example.com
# Password: admin123456

==========================================================
  步驟 5: 啟動後端服務
==========================================================

pnpm dev:backend

# 或直接在 backend 目錄啟動：
cd apps\backend
pnpm dev

# 服務將運行於: http://localhost:3000

==========================================================
  步驟 6: 測試 API
==========================================================

# 在瀏覽器開啟：
http://localhost:3000/api/health

# 或使用 PowerShell 測試：

# 健康檢查
Invoke-RestMethod -Uri "http://localhost:3000/api/health"

# 登入測試
$body = @{
    email = "admin@example.com"
    password = "admin123456"
} | ConvertTo-Json

$response = Invoke-RestMethod -Uri "http://localhost:3000/api/auth/login" -Method Post -ContentType "application/json" -Body $body

# 顯示登入結果
$response

# 儲存 Token 供後續使用
$token = $response.accessToken

==========================================================
  常用指令
==========================================================

# 開發模式（熱重載）
pnpm dev:backend

# 建置
pnpm build:backend

# 生產模式
pnpm --filter backend start:prod

# 執行測試
pnpm --filter backend test

# Lint 檢查
pnpm --filter backend lint

# 資料庫遷移
pnpm --filter backend migration:run

# 資料庫回滾
pnpm --filter backend migration:revert

# 重新執行 Seed
pnpm --filter backend seed

==========================================================
  重要連結
==========================================================

API 服務: http://localhost:3000
健康檢查: http://localhost:3000/api/health
MinIO 控制台: http://localhost:9001

==========================================================
  故障排除
==========================================================

問題 1: 無法連接資料庫
解決: Get-Service postgresql*; Start-Service postgresql-x64-18

問題 2: 無法連接 MinIO
解決: C:\minio\start-minio.bat

問題 3: Port 3000 被占用
解決: 修改 apps/backend/.env 中的 PORT=3001

問題 4: 遷移失敗
解決: 確認 DATABASE_URL 正確，檢查資料庫連線

==========================================================
  開發團隊
==========================================================

專案文件:
- README.md - 完整專案說明
- QUICKSTART.md - 快速啟動指南
- STRUCTURE.md - 專案結構說明
- 專案建立完成.md - 建立摘要

==========================================================


# 廠商安全評估系統 - 環境建立指南

> 根據 MVP 專案執行文件，逐步建立開發環境

## 📋 目錄

- [前置檢查](#前置檢查)
- [步驟 1：安裝必要工具](#步驟-1安裝必要工具)
- [步驟 2：建立專案結構](#步驟-2建立專案結構)
- [步驟 3：初始化 Monorepo](#步驟-3初始化-monorepo)
- [步驟 4：建立共用套件](#步驟-4建立共用套件)
- [步驟 5：建立後端專案](#步驟-5建立後端專案)
- [步驟 6：建立前端專案](#步驟-6建立前端專案)
- [步驟 7：設定基礎設施](#步驟-7設定基礎設施)
- [步驟 8：啟動開發環境](#步驟-8啟動開發環境)
- [驗證清單](#驗證清單)

---

## 前置檢查

在開始之前，請確認您的作業系統與開發環境：

- ✅ **作業系統**: Windows 10/11, macOS, 或 Linux
- ✅ **網路連線**: 穩定的網路（需要下載依賴套件）
- ✅ **磁碟空間**: 至少 5GB 可用空間
- ✅ **權限**: 管理員權限（安裝軟體時需要）

---

## 步驟 1：安裝必要工具

### 1.1 安裝 Node.js

```bash
# 檢查是否已安裝
node --version  # 應該 >= 18.0.0

# 如果未安裝，請前往下載
# Windows/macOS: https://nodejs.org/
# 建議安裝 LTS 版本（v20.x）
```

**Windows 安裝步驟**：
1. 下載 Node.js LTS 安裝檔
2. 執行安裝檔，按照指示完成安裝
3. 重新啟動命令提示字元
4. 驗證安裝：`node --version`

### 1.2 安裝 pnpm

```bash
# 使用 npm 全域安裝 pnpm
npm install -g pnpm@8.15.0

# 驗證安裝
pnpm --version  # 應該顯示 8.15.0
```

**為什麼使用 pnpm？**
- 🚀 比 npm/yarn 更快
- 💾 節省磁碟空間（硬連結機制）
- 🔒 更嚴格的依賴管理
- ✨ 原生支援 Monorepo

### 1.3 安裝 Docker Desktop

**Windows 用戶**：
1. 前往 [Docker Desktop for Windows](https://www.docker.com/products/docker-desktop)
2. 下載並安裝 Docker Desktop
3. 安裝完成後，啟動 Docker Desktop
4. 確認 WSL 2 已啟用（Docker Desktop 會自動處理）

**驗證安裝**：
```bash
docker --version        # 應該 >= 20.10.0
docker-compose --version # 應該 >= 2.0.0
```

### 1.4 安裝 Git

```bash
# 檢查是否已安裝
git --version

# Windows: https://git-scm.com/download/win
# macOS: 通常已預裝，或使用 Homebrew
brew install git
```

### 1.5 安裝程式碼編輯器（推薦 VS Code）

1. 下載 [Visual Studio Code](https://code.visualstudio.com/)
2. 安裝以下擴充套件：
   - **ESLint** - 程式碼檢查
   - **Prettier** - 程式碼格式化
   - **TypeScript Vue Plugin (Volar)** - TypeScript 支援
   - **Docker** - Docker 檔案支援
   - **GitLens** - Git 增強工具

---

## 步驟 2：建立專案結構

### 2.1 建立專案根目錄

```bash
# 在您的工作目錄中執行
mkdir Dataresource_MVP_Backend
cd Dataresource_MVP_Backend
```

### 2.2 建立 Monorepo 資料夾結構

```bash
# Windows PowerShell
mkdir apps, packages, apps\backend, apps\frontend, packages\shared

# macOS/Linux
mkdir -p apps/backend apps/frontend packages/shared
```

### 2.3 初始化 Git 倉庫

```bash
git init
git branch -M main

# 建立 .gitignore
echo "node_modules/" > .gitignore
echo ".env" >> .gitignore
echo ".env.local" >> .gitignore
echo "dist/" >> .gitignore
echo ".next/" >> .gitignore
echo ".turbo/" >> .gitignore
echo ".DS_Store" >> .gitignore
```

---

## 步驟 3：初始化 Monorepo

### 3.1 建立 Root package.json

在專案根目錄建立 `package.json`：

```bash
pnpm init
```

編輯 `package.json`，內容如下：

```json
{
  "name": "dataresource-mvp",
  "version": "1.0.0",
  "private": true,
  "description": "廠商安全評估資料蒐集系統",
  "scripts": {
    "dev": "turbo run dev",
    "build": "turbo run build",
    "test": "turbo run test",
    "lint": "turbo run lint",
    "clean": "turbo run clean && rm -rf node_modules",
    "dev:backend": "pnpm --filter backend dev",
    "dev:frontend": "pnpm --filter frontend dev",
    "build:backend": "pnpm --filter backend build",
    "build:frontend": "pnpm --filter frontend build"
  },
  "devDependencies": {
    "turbo": "^2.0.0",
    "typescript": "^5.3.0"
  },
  "engines": {
    "node": ">=18.0.0",
    "pnpm": ">=8.0.0"
  },
  "packageManager": "pnpm@8.15.0"
}
```

### 3.2 建立 pnpm-workspace.yaml

在專案根目錄建立 `pnpm-workspace.yaml`：

```yaml
packages:
  - 'apps/*'
  - 'packages/*'
```

### 3.3 建立 turbo.json（可選，用於加速建置）

在專案根目錄建立 `turbo.json`：

```json
{
  "$schema": "https://turbo.build/schema.json",
  "globalDependencies": [".env"],
  "pipeline": {
    "build": {
      "dependsOn": ["^build"],
      "outputs": ["dist/**", ".next/**"]
    },
    "dev": {
      "cache": false,
      "persistent": true
    },
    "lint": {
      "dependsOn": ["^build"]
    },
    "test": {
      "dependsOn": ["^build"]
    },
    "clean": {
      "cache": false
    }
  }
}
```

### 3.4 安裝根目錄依賴

```bash
pnpm install
```

---

## 步驟 4：建立共用套件

### 4.1 初始化 shared 套件

```bash
cd packages/shared
pnpm init
```

### 4.2 建立 packages/shared/package.json

```json
{
  "name": "shared",
  "version": "1.0.0",
  "main": "./src/index.ts",
  "types": "./src/index.ts",
  "exports": {
    ".": "./src/index.ts",
    "./types": "./src/types/index.ts",
    "./constants": "./src/constants/index.ts",
    "./utils": "./src/utils/index.ts"
  },
  "scripts": {
    "lint": "tsc --noEmit"
  },
  "devDependencies": {
    "typescript": "^5.3.0"
  }
}
```

### 4.3 建立 packages/shared/tsconfig.json

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "ESNext",
    "moduleResolution": "bundler",
    "declaration": true,
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules"]
}
```

### 4.4 建立共用型別檔案結構

```bash
# Windows PowerShell
cd packages\shared
mkdir src, src\types, src\constants, src\utils
New-Item -Path "src\index.ts" -ItemType File
New-Item -Path "src\types\index.ts" -ItemType File
New-Item -Path "src\constants\index.ts" -ItemType File
New-Item -Path "src\utils\index.ts" -ItemType File

# macOS/Linux
cd packages/shared
mkdir -p src/types src/constants src/utils
touch src/index.ts src/types/index.ts src/constants/index.ts src/utils/index.ts
```

### 4.5 建立基本型別定義

建立 `packages/shared/src/types/user.types.ts`：

```typescript
export enum UserRole {
  SUPER_ADMIN = 'SUPER_ADMIN',
  ADMIN = 'ADMIN',
  VIEWER = 'VIEWER',
}

export interface User {
  id: string
  email: string
  name: string
  role: UserRole
  isActive: boolean
  createdAt: Date
  updatedAt: Date
}

export interface LoginDto {
  email: string
  password: string
}

export interface AuthResponse {
  accessToken: string
  user: User
}
```

建立 `packages/shared/src/types/project.types.ts`：

```typescript
export enum ProjectStatus {
  DRAFT = 'DRAFT',
  ACTIVE = 'ACTIVE',
  COMPLETED = 'COMPLETED',
  ARCHIVED = 'ARCHIVED',
}

export interface Project {
  id: string
  name: string
  description: string
  status: ProjectStatus
  uploadToken: string
  createdAt: Date
  updatedAt: Date
}

export interface CreateProjectDto {
  name: string
  description: string
  requiredDocumentIds: string[]
}
```

建立 `packages/shared/src/constants/status.ts`：

```typescript
export const STATUS_LABELS = {
  DRAFT: '草稿',
  ACTIVE: '進行中',
  COMPLETED: '已完成',
  ARCHIVED: '已歸檔',
  PENDING: '待上傳',
  UPLOADED: '已上傳',
  APPROVED: '已通過',
  REJECTED: '已退回',
} as const

export const STATUS_COLORS = {
  DRAFT: 'gray',
  ACTIVE: 'blue',
  COMPLETED: 'green',
  ARCHIVED: 'gray',
  PENDING: 'yellow',
  UPLOADED: 'blue',
  APPROVED: 'green',
  REJECTED: 'red',
} as const
```

更新 `packages/shared/src/index.ts`：

```typescript
export * from './types/user.types'
export * from './types/project.types'
export * from './constants/status'
```

---

## 步驟 5：建立後端專案

### 5.1 使用 NestJS CLI 建立專案

```bash
# 回到專案根目錄
cd ../..

# 安裝 NestJS CLI（全域）
npm install -g @nestjs/cli

# 在 apps 目錄中建立後端專案
cd apps
nest new backend --skip-git --package-manager pnpm

# 回到根目錄
cd ..
```

### 5.2 安裝後端依賴

```bash
pnpm --filter backend add @nestjs/typeorm @nestjs/jwt @nestjs/passport @nestjs/config
pnpm --filter backend add typeorm pg minio passport passport-jwt bcrypt
pnpm --filter backend add class-validator class-transformer
pnpm --filter backend add shared@workspace:*

# 安裝開發依賴
pnpm --filter backend add -D @types/passport-jwt @types/bcrypt
```

### 5.3 建立後端環境變數範本

建立 `apps/backend/.env.example`：

```bash
# ====================================
# 資料庫配置
# ====================================
DATABASE_URL=postgresql://admin:password123@localhost:5432/vendor_assessment

# ====================================
# JWT 認證配置
# ====================================
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production
JWT_EXPIRES_IN=7d

# ====================================
# MinIO / S3 儲存配置
# ====================================
MINIO_ENDPOINT=localhost
MINIO_PORT=9000
MINIO_USE_SSL=false
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin123
MINIO_BUCKET=uploads

# ====================================
# CORS 配置
# ====================================
CORS_ORIGIN=http://localhost:3001

# ====================================
# 應用程式配置
# ====================================
PORT=3000
NODE_ENV=development
```

### 5.4 建立後端 Dockerfile

建立 `apps/backend/Dockerfile`：

```dockerfile
FROM node:18-alpine

# 安裝 pnpm
RUN npm install -g pnpm@8.15.0

WORKDIR /app

# 複製必要檔案
COPY package.json pnpm-workspace.yaml pnpm-lock.yaml ./
COPY packages/shared ./packages/shared
COPY apps/backend ./apps/backend

# 安裝依賴
RUN pnpm install --frozen-lockfile

# 建置
WORKDIR /app/apps/backend
RUN pnpm run build

# 執行
EXPOSE 3000
CMD ["node", "dist/main.js"]
```

---

## 步驟 6：建立前端專案

### 6.1 建立 Next.js 專案

```bash
# 回到 apps 目錄
cd apps

# 建立 Next.js 專案
pnpm create next-app@14 frontend --typescript --tailwind --app --no-src-dir

# 回到根目錄
cd ..
```

### 6.2 安裝前端依賴

```bash
pnpm --filter frontend add axios
pnpm --filter frontend add shared@workspace:*
```

### 6.3 建立前端環境變數範本

建立 `apps/frontend/.env.local.example`：

```bash
# ====================================
# API 配置
# ====================================
NEXT_PUBLIC_API_URL=http://localhost:3000

# ====================================
# 應用程式配置
# ====================================
NEXT_PUBLIC_APP_NAME=廠商安全評估系統
NEXT_PUBLIC_MAX_FILE_SIZE=104857600
NEXT_PUBLIC_ALLOWED_FILE_TYPES=pdf,dwg,doc,docx,xls,xlsx
```

### 6.4 建立前端 Dockerfile

建立 `apps/frontend/Dockerfile`：

```dockerfile
FROM node:18-alpine

# 安裝 pnpm
RUN npm install -g pnpm@8.15.0

WORKDIR /app

# 複製必要檔案
COPY package.json pnpm-workspace.yaml pnpm-lock.yaml ./
COPY packages/shared ./packages/shared
COPY apps/frontend ./apps/frontend

# 安裝依賴
RUN pnpm install --frozen-lockfile

# 建置
WORKDIR /app/apps/frontend
RUN pnpm run build

# 執行
EXPOSE 3001
CMD ["pnpm", "start"]
```

---

## 步驟 7：設定基礎設施

### 7.1 建立 docker-compose.yml

在專案根目錄建立 `docker-compose.yml`：

```yaml
version: '3.8'

services:
  postgres:
    image: postgres:18-alpine
    container_name: vendor-assessment-postgres
    environment:
      POSTGRES_DB: vendor_assessment
      POSTGRES_USER: admin
      POSTGRES_PASSWORD: password123
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U admin"]
      interval: 10s
      timeout: 5s
      retries: 5

  minio:
    image: minio/minio:latest
    container_name: vendor-assessment-minio
    command: server /data --console-address ":9001"
    environment:
      MINIO_ROOT_USER: minioadmin
      MINIO_ROOT_PASSWORD: minioadmin123
    ports:
      - "9000:9000"
      - "9001:9001"
    volumes:
      - minio_data:/data
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9000/minio/health/live"]
      interval: 30s
      timeout: 20s
      retries: 3

volumes:
  postgres_data:
    driver: local
  minio_data:
    driver: local
```

### 7.2 啟動基礎設施

```bash
# 啟動 PostgreSQL 和 MinIO
docker-compose up -d

# 查看服務狀態
docker-compose ps

# 查看日誌
docker-compose logs -f
```

### 7.3 驗證基礎設施

```bash
# 檢查 PostgreSQL
docker exec -it vendor-assessment-postgres psql -U admin -d vendor_assessment -c "SELECT 1;"

# 訪問 MinIO Console
# 開啟瀏覽器：http://localhost:9001
# 帳號：minioadmin
# 密碼：minioadmin123
```

---

## 步驟 8：啟動開發環境

### 8.1 複製環境變數檔案

```bash
# 後端
cp apps/backend/.env.example apps/backend/.env

# 前端
cp apps/frontend/.env.local.example apps/frontend/.env.local
```

### 8.2 啟動開發伺服器

```bash
# 方式 1：同時啟動前後端
pnpm dev

# 方式 2：分別啟動
# 終端機 1 - 後端
pnpm dev:backend

# 終端機 2 - 前端
pnpm dev:frontend
```

### 8.3 存取應用程式

- **後端 API**: http://localhost:3000
- **前端介面**: http://localhost:3001
- **MinIO Console**: http://localhost:9001
- **PostgreSQL**: localhost:5432

---

## 驗證清單

### ✅ 工具安裝確認

```bash
# 執行以下指令，確認版本號碼正確
node --version      # >= 18.0.0
pnpm --version      # >= 8.0.0
docker --version    # >= 20.10.0
git --version       # 任何版本
```

### ✅ 專案結構確認

```
Dataresource_MVP_Backend/
├── apps/
│   ├── backend/         ✅ NestJS 專案
│   └── frontend/        ✅ Next.js 專案
├── packages/
│   └── shared/          ✅ 共用套件
├── package.json         ✅ Root package.json
├── pnpm-workspace.yaml  ✅ Workspace 配置
├── turbo.json           ✅ Turborepo 配置
└── docker-compose.yml   ✅ Docker 配置
```

### ✅ 服務運行確認

```bash
# PostgreSQL
docker-compose ps postgres  # 狀態應為 Up

# MinIO
docker-compose ps minio     # 狀態應為 Up

# 後端
curl http://localhost:3000  # 應該有回應

# 前端
curl http://localhost:3001  # 應該有回應
```

### ✅ 依賴安裝確認

```bash
# 檢查 node_modules
ls node_modules/            # 應該有檔案
ls apps/backend/node_modules/
ls apps/frontend/node_modules/
ls packages/shared/node_modules/
```

---

## 🎉 環境建立完成！

恭喜您完成環境建立！接下來可以：

1. **開始開發功能模組**
   - 使用者認證模組
   - 專案管理模組
   - 檔案上傳模組
   - 審核流程模組

2. **設定資料庫 Schema**
   - 建立 Migration 檔案
   - 執行資料庫遷移

3. **開發前端頁面**
   - 登入頁面
   - 管理後台
   - 檔案上傳介面

---

## 🆘 遇到問題？

### 常見問題排除

1. **pnpm 安裝失敗**
   ```bash
   # 清除快取
   pnpm store prune
   pnpm install
   ```

2. **Docker 無法啟動**
   ```bash
   # Windows: 確認 Docker Desktop 正在執行
   # 檢查 WSL 2 是否已啟用
   wsl --list --verbose
   ```

3. **Port 被佔用**
   ```bash
   # Windows: 查找佔用 Port 的程序
   netstat -ano | findstr :3000
   
   # 終止程序（使用上面查到的 PID）
   taskkill /PID <PID> /F
   ```

4. **TypeScript 錯誤**
   ```bash
   # 重啟 TypeScript 伺服器（VS Code）
   # Ctrl+Shift+P → "TypeScript: Restart TS Server"
   ```

---

## 📚 下一步

查看以下文件以繼續開發：

- **MVP開發計畫.md** - 了解開發目標與功能範圍
- **廠商安全評估系統-後端技術討論紀錄.md** - 了解技術架構細節
- **MVP專案執行文件.md** - 完整的開發與部署指南

---

**建立日期**: 2025-10-27  
**適用版本**: MVP v1.0  
**維護者**: 開發團隊

